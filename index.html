<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Blackjack — Version avec animations de distribution et éventail</title>
  <style>
    :root{
      --felt:#0a4d3c; --felt-dark:#083d30; --gold:#e1b866;
      --chip-red:#c0392b; --chip-blue:#2980b9; --chip-green:#27ae60; --chip-black:#2c3e50;
      --win:#19c37d; --lose:#ff4b4b; --push:#f39c12;
    }
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial; color:#f4f6f8;
      background: radial-gradient(1200px 600px at 50% 10%, #0f6d56, var(--felt));}
    .table{max-width:1100px;margin:24px auto;padding:24px;border-radius:24px;position:relative;
      background: radial-gradient(100% 100% at 50% 0%, #0f6d56 0%, var(--felt-dark) 100%);
      box-shadow:0 20px 50px rgba(0,0,0,.4), inset 0 0 0 2px rgba(225,184,102,.15); min-height:700px; overflow:hidden}

    .shoe{position:absolute; right:22px; top:94px; width:120px; height:70px; background:#1a1f25; border-radius:12px; border:1px solid #31363b; box-shadow:inset 0 10px 30px rgba(0,0,0,.5)}
    .shoe::after{content:""; position:absolute; inset:6px; border-radius:10px; background: repeating-linear-gradient(90deg, #dfe4ea 0 6px, #c7ccd2 6px 12px); mix-blend:multiply; opacity:.85}

    .hand{position:absolute; left:50%; transform:translateX(-50%); width:min(92%,860px); height:210px; display:flex; align-items:flex-end; justify-content:center}
    .hand.dealer{top:16px}
    .hand.player{bottom:100px}
    .cards{position:relative; width:100%; height:168px; perspective: 900px}
    .card{position:absolute; width:92px; height:132px; border-radius:10px; background:#fff; color:#111; border:1px solid #d9dde2; box-shadow:0 10px 30px rgba(0,0,0,.35); transition: transform .45s ease,left .45s ease,top .45s ease}
    .card.back{background: repeating-linear-gradient(45deg, #28313b 0 6px, #1f262e 6px 12px); border-color:#1b232b}
    .card .rank{position:absolute; top:6px; left:8px; font-weight:800; font-size:18px}
    .card .suit{position:absolute; bottom:8px; right:8px; font-size:22px}
    .badge{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); padding:8px 14px; border-radius:999px; background:rgba(17,18,20,.7); font-weight:800}
    .badge.win{background:#19c37d;color:#08150f} .badge.lose{background:#ff4b4b;color:#3f0d0d} .badge.push{background:#f39c12;color:#33210a}

    .bet-area{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:300px; height:160px; border:2px dashed rgba(225,184,102,.45); border-radius:90px; display:grid; place-items:center; box-shadow: inset 0 0 60px rgba(0,0,0,.25)}
    .bet-amount{font-weight:800; font-size:22px; color:var(--gold)}

    .controls{position:absolute; left:50%; transform:translateX(-50%); bottom:20px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
    .btn{padding:10px 14px; border-radius:12px; font-weight:800; border:1px solid rgba(225,184,102,.35); background:#132d25; color:#f6f6f6; cursor:pointer}
    .btn[disabled]{opacity:.45; cursor:not-allowed}
    .btn:hover{box-shadow:0 0 0 2px var(--gold),0 0 18px rgba(225,184,102,.45)}

    .chips{position:absolute; inset:0; pointer-events:none}
    .chip{position:absolute; width:48px; height:48px; border-radius:50%; display:grid; place-items:center; font-weight:900; color:#fff; border:3px solid #fff; box-shadow:0 8px 18px rgba(0,0,0,.35); transform: translate(-50%,-50%)}
    .chip.red{background:var(--chip-red)} .chip.blue{background:var(--chip-blue)} .chip.green{background:var(--chip-green)} .chip.black{background:var(--chip-black)}
  </style>
</head>
<body>
  <div class="table">
    <div class="shoe" id="shoe"></div>

    <div class="hand dealer">
      <div class="cards" id="dealerCards"></div>
      <div class="badge" id="dealerBadge">—</div>
    </div>
    <div class="bet-area" id="betArea"><div class="bet-amount">Place ta mise</div></div>
    <div class="hand player">
      <div class="cards" id="playerCards"></div>
      <div class="badge" id="playerBadge">—</div>
    </div>
    <div class="chips" id="chips"></div>

    <div class="controls">
      <button class="btn" data-chip="25">+25</button>
      <button class="btn" data-chip="50">+50</button>
      <button class="btn" data-chip="100">+100</button>
      <button class="btn" id="clearBet">Effacer mise</button>
      <button class="btn" id="dealBtn">Distribuer</button>
      <button class="btn" id="hitBtn" disabled>Tirer</button>
      <button class="btn" id="standBtn" disabled>Rester</button>
    </div>
  </div>
  <script>
  const $=s=>document.querySelector(s);
  const $$=s=>Array.from(document.querySelectorAll(s));
  const sleep=ms=>new Promise(r=>setTimeout(r,ms));

  const RULES={decks:6,dealerStandsSoft17:true};
  const state={player:[],dealer:[],resolved:false,inRound:false,shoe:[],bet:0,bankroll:1000};
  const ranks=["A","2","3","4","5","6","7","8","9","10","J","Q","K"], suits=["♠","♥","♦","♣"];

  function buildShoe(){const shoe=[];for(let d=0;d<RULES.decks;d++){for(const s of suits){for(const r of ranks){shoe.push({r,s})}}}return shoe.sort(()=>Math.random()-0.5)}
  function isTen(r){return["10","J","Q","K"].includes(r)}
  function cardValue(c){return c.r=="A"?11:isTen(c.r)?10:Number(c.r)}
  function handTotals(cs){let t=0,a=0;for(const c of cs){if(c.r=="A"){a++;t+=11}else t+=cardValue(c)}while(t>21&&a>0){t-=10;a--}return{total:t,soft:a>0&&t<=21}}
  function dealerShouldHit(cs){const {total,soft}=handTotals(cs);if(total<17)return true;if(total==17&&soft)return !RULES.dealerStandsSoft17;return false}

  function createCardEl(c,faceDown=false){const el=document.createElement("div");el.className="card";if(faceDown){el.classList.add("back");}else{el.innerHTML=`<div class='rank'>${c.r}</div><div class='suit'>${c.s}</div>`;}return el}

  function fanCards(container){
    const cards=[...container.children];
    const n=cards.length, spread=Math.min(18*n,140), start=-spread/2, baseLeft=container.clientWidth/2-46;
    cards.forEach((c,i)=>{
      const angle=start+(spread/(Math.max(n-1,1)))*i, offset=(i-(n-1)/2)*22;
      c.style.left=baseLeft+offset+'px'; c.style.top=(Math.abs(angle)*0.4)+'px'; c.style.transform=`rotate(${angle/6}deg)`;
    });
  }

  function updateBadges(){
    const p=handTotals(state.player), d=handTotals(state.dealer);
    const pb=$('#playerBadge'), db=$('#dealerBadge');
    pb.className='badge'; db.className='badge';
    pb.textContent=p.total>0?p.total:"—";
    if(state.resolved){
      db.textContent=d.total>0?d.total:"—";
    } else if(state.inRound){
      db.textContent=state.dealer.length?handTotals([state.dealer[0]]).total:"—";
    } else {
      db.textContent="—";
    }
  }

  function setOutcomeBadge(outcome){
    const pb=$('#playerBadge'), db=$('#dealerBadge');
    const d=handTotals(state.dealer);
    pb.className='badge'; db.className='badge';
    if(outcome==='win'){pb.classList.add('win'); pb.textContent='WIN!';}
    else if(outcome==='blackjack'){pb.classList.add('win'); pb.textContent='BLACKJACK!';}
    else if(outcome==='lose'){pb.classList.add('lose'); pb.textContent='NO WIN';}
    else if(outcome==='bust'){pb.classList.add('lose'); pb.textContent='BUST';}
    else {pb.classList.add('push'); pb.textContent='PUSH';}
    db.textContent=d.total>0?d.total:"—";
  }

  async function revealDealerHole(){
    const dc=$('#dealerCards');
    const hole=dc.querySelector('.card.back');
    if(!hole)return;
    hole.style.transition='transform .3s ease';
    hole.style.transform='rotateY(90deg)';
    await sleep(300);
    const real=state.dealer[1];
    hole.classList.remove('back');
    hole.innerHTML=`<div class='rank'>${real.r}</div><div class='suit'>${real.s}</div>`;
    hole.style.transform='rotateY(0deg)';
    await sleep(300);
    updateBadges();
  }

  function takeCard(){if(state.shoe.length==0) state.shoe=buildShoe(); return state.shoe.pop()}

  function clearHands(){state.player=[];state.dealer=[];$('#playerCards').innerHTML='';$('#dealerCards').innerHTML='';}

  async function dealCardAnimated(toContainer,targetArray,card,{faceDown=false}={}){
    const el=createCardEl(card,faceDown);
    el.style.position='absolute';
    const shoeRect=$('#shoe').getBoundingClientRect();
    el.style.left=shoeRect.left+'px';
    el.style.top=shoeRect.top+'px';
    document.body.appendChild(el);
    await sleep(20);
    toContainer.appendChild(el);
    targetArray.push(card);
    fanCards(toContainer);
    updateBadges();
    await sleep(300);
  }

  async function initialDeal(){
    clearHands();
    state.inRound=true; state.resolved=false;
    await dealCardAnimated($('#playerCards'),state.player,takeCard());
    await dealCardAnimated($('#dealerCards'),state.dealer,takeCard());
    await dealCardAnimated($('#playerCards'),state.player,takeCard());
    await dealCardAnimated($('#dealerCards'),state.dealer,takeCard(),{faceDown:true});
    $('#hitBtn').disabled=false; $('#standBtn').disabled=false;
  }

  async function hit(){
    await dealCardAnimated($('#playerCards'),state.player,takeCard());
    if(handTotals(state.player).total>21){await revealDealerHole(); setOutcomeBadge('bust'); state.inRound=false; state.resolved=true; $('#hitBtn').disabled=true; $('#standBtn').disabled=true;}
  }

  async function stand(){
    await revealDealerHole();
    while(dealerShouldHit(state.dealer)){
      await dealCardAnimated($('#dealerCards'),state.dealer,takeCard());
      await sleep(400);
    }
    const pT=handTotals(state.player).total, dT=handTotals(state.dealer).total;
    let outcome='push'; if(dT>21||pT>dT) outcome='win'; else if(dT>pT) outcome='lose';
    if(pT===21 && state.player.length===2 && !(dT===21 && state.dealer.length===2)) outcome='blackjack';
    setOutcomeBadge(outcome); state.inRound=false; state.resolved=true; $('#hitBtn').disabled=true; $('#standBtn').disabled=true;
  }

  function addBet(amount,fromBtn){state.bet+=amount;$('#betArea .bet-amount').textContent=`Mise: $${state.bet}`;const chip=document.createElement('div');chip.className=`chip ${amount==100?'black':amount==50?'blue':'green'}`;chip.textContent=amount;const r=$('#betArea').getBoundingClientRect();chip.style.left=(r.left+r.width/2)+'px';chip.style.top=(r.top+r.height/2)+'px';$('#chips').appendChild(chip);}

  $$('[data-chip]').forEach(btn=>btn.addEventListener('click',()=>addBet(Number(btn.dataset.chip),btn)));
  $('#clearBet').addEventListener('click',()=>{state.bet=0;$('#betArea .bet-amount').textContent='Place ta mise';$('#chips').innerHTML='';});
  $('#dealBtn').addEventListener('click',initialDeal);
  $('#hitBtn').addEventListener('click',hit);
  $('#standBtn').addEventListener('click',stand);
  </script>
  <!-- Effet clic souris -->
  <div class="fx-layer" id="fx"></div>
  <script>
  const OSMO_PATH_D = "M3.5 5L3.50049 3.9468C3.50049 3.177 4.33382 2.69588 5.00049 3.08078L20.0005 11.741C20.6672 12.1259 20.6672 13.0882 20.0005 13.4731L17.2388 15.1412L17.0055 15.2759M3.50049 8L3.50049 21.2673C3.50049 22.0371 4.33382 22.5182 5.00049 22.1333L14.1192 16.9423L14.4074 16.7759";
  const layer = document.getElementById(fx);
  function spawnStrokeAt(x,y){const size=64;const svgNS="http://www.w3.org/2000/svg";const svg=document.createElementNS(svgNS,"svg");svg.setAttribute("viewBox","0 0 24 25");svg.setAttribute("width",size);svg.setAttribute("height",size);svg.style.position="absolute";svg.style.left=(x-size/2)+"px";svg.style.top=(y-size/2)+"px";svg.style.opacity="0";svg.style.pointerEvents="none";const path=document.createElementNS(svgNS,"path");path.setAttribute("d",OSMO_PATH_D);path.setAttribute("stroke","#e1b866");path.setAttribute("stroke-width","2");path.setAttribute("fill","none");path.setAttribute("stroke-linecap","round");svg.appendChild(path);layer.appendChild(svg);const len=path.getTotalLength();path.style.strokeDasharray=len;path.style.strokeDashoffset=len;const tl=gsap.timeline({onComplete:()=>layer.removeChild(svg)});tl.to(svg,{duration:.08,opacity:1}).to(path,{duration:.45,strokeDashoffset:0,ease:"power3.out"},0).to(svg,{duration:.25,opacity:0,ease:"power2.in"},"+=0.25");}
  window.addEventListener("click",(e)=>{spawnStrokeAt(e.clientX,e.clientY)});
  </script>
</body>
</html>
